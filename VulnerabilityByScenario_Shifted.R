library(reshape2)
library(ggplot2)
library(lubridate)
library(plyr)
#Set directory
setwd('C:/Users/carly/Google Drive/University of Utah - Research/Research Assistant/SnowpackDynamics (iUTAH and NASA projects)/ModelResults/Shifted/Vulnerability')
#List files in folder
filelist=list.files(path=".",pattern="*.csv")
numfiles=length(filelist)
scenarios=c("1WeekShift","2WeekShift","3WeekShift","4WeekShift","5WeekShift","6WeekShift","7WeekShift","8WeekShift","Baseline")

vulnerabilitydf=data.frame(Year=0,Vul_BC=0,Vul_LC=0,Vul_PC=0,Vul_CC=0,System=0,Scenario=0)
for (i in seq(1,numfiles)){
  tempdata=read.csv(filelist[i])
  tempdata$Date=as.Date(strptime(tempdata$Date,format="%m/%d/%Y"))
  tempdata$Year=year(tempdata$Date)
  System=with(tempdata,((Vul_BC+Vul_CC+Vul_PC+Vul_CC)/4))
  tempdata$System=System
  avgBC=aggregate(Vul_BC ~ Year, tempdata, mean)
  avgLC=aggregate(Vul_LC ~ Year, tempdata, mean)
  avgPC=aggregate(Vul_PC ~ Year, tempdata, mean)
  avgCC=aggregate(Vul_CC ~ Year, tempdata, mean)
  avgSystem=aggregate(System ~ Year, tempdata, mean)
  vuldf=cbind(avgBC,avgLC,avgPC,avgCC,avgSystem)
  vuldf=vuldf[,-c(3,5,7,9)]
  vuldf$Scenario=scenarios[i]

  vulnerabilitydf=rbind(vulnerabilitydf,vuldf)

  png(file = paste0(scenarios[i],".png"))
  with(tempdata,plot(x=Date,y=Vul_BC,type="l",ylab="Vulnerability",xlab="Date",ylim=c(0,1),
                     main=paste0("Vulnerability \n in Wasatch Streams - ",scenarios[i])))
  with(tempdata,lines(x=Date,y=Vul_CC,col=2))
  with(tempdata,lines(x=Date,y=Vul_LC,col=3))
  with(tempdata,lines(x=Date,y=Vul_PC,col=4))
  dev.off()
}
vulnerabilitydf=vulnerabilitydf[-1,]
aggregate(. ~ Scenario, vulnerabilitydf, mean)



