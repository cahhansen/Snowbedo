library(reshape2)
library(ggplot2)
library(lubridate)
library(plyr)
#Set directory
setwd('C:/Users/carly/Google Drive/University of Utah - Research/Research Assistant/SnowpackDynamics (iUTAH and NASA projects)/ModelResults/Vulnerability')
#List files in folder
filelist=list.files(path=".",pattern="*.csv")
numfiles=length(filelist)
scenarios=c("10 Percent Decrease in Albedo","20 Percent Decrease in Albedo","30 Percent Decrease in Albedo",
            "40 Percent Decrease in Albedo","50 Percent Decrease in Albedo","60 Percent Decrease in Albedo",
            "70 Percent Decrease in Albedo","80 Percent Decrease in Albedo","90 Percent Decrease in Albedo","Baseline")

vulnerabilitydf=data.frame(Year=0,Big.Cottonwood=0,Little.Cottonwood=0,Parleys.Creek=0,City.Creek=0,Scenario=0)
for (i in seq(1,numfiles)){
  tempdata=read.csv(filelist[i])
  tempdata$Date=as.Date(strptime(tempdata$Date,format="%m/%d/%Y"))
  tempdata$Year=year(tempdata$Date)

  avgBC=aggregate(Big.Cottonwood ~ Year, tempdata, mean)
  avgLC=aggregate(Little.Cottonwood ~ Year, tempdata, mean)
  avgPC=aggregate(Parleys.Creek ~ Year, tempdata, mean)
  avgCC=aggregate(City.Creek ~ Year, tempdata, mean)
  vuldf=cbind(avgBC,avgLC,avgPC,avgCC)
  vuldf=vuldf[,-c(3,5,7)]
  vuldf$Scenario=scenarios[i]

  vulnerabilitydf=rbind(vulnerabilitydf,vuldf)

  png(file = paste0(scenarios[i],".png"))
  with(tempdata,plot(x=Date,y=Big.Cottonwood,type="l",ylab="Normalized Vulnerability",xlab="Date",ylim=c(0,1),
                     main=paste0("Vulnerability \n in Wasatch Streams - ",scenarios[i])))
  with(tempdata,lines(x=Date,y=City.Creek,col=2))
  with(tempdata,lines(x=Date,y=Little.Cottonwood,col=3))
  with(tempdata,lines(x=Date,y=Parleys.Creek,col=4))
  dev.off()
}
vulnerabilitydf=vulnerabilitydf[-1,]




